#!/usr/bin/python

def tr(s) :
	return s


def generateLiloConfFile(targetPartition) :
	import os
	cmd = 'fdisk -l'
	lines = os.popen(cmd).readlines()

	lines = filter(lambda x:x.find('FAT') > -1 or x.find('NTFS') > -1,lines)

	bootableWindowsPartitions = []
	for line in lines :
		l = line.split()
		if len(l) > 1 and l[1] == '*' :
			bootableWindowsPartitions.append(devToGrub(l[0]))


	o = """
boot=/dev/hda
lba32
prompt
timeout=50
menu-title=" GoboLinux 013
		"""
	o += '\n'
	o += 'image=/System/Kernel/Boot/kernel'+'\n'
	o += '  label=GoboLinux' + '\n'
	o += '  root=/dev/'+targetPartition+'\n'
	o += '  video=vesafb:off\n'
	o += '  append="acpi=off"\n'
	
	o += '\n'
	o += '  image=/System/Kernel/Boot/kernel'+'\n'
	o += '  label=GoboLinux - Framebuffer' + '\n'
	o += '  root=/dev/'+targetPartition+'\n'
	o += '  append="acpi=off"\n'
	
	for partition in bootableWindowsPartitions:
		o += '\n'
		o += 'other=/dev/' + partition + '\n'
		o += '  label= Other OS at %s'%partition + '\n'

	return o
	#safeWriteToFile(destMountPoint+'/System/Kernel/Boot/grub/menu.lst', o, logger)


if __name__ == '__main__' :
	import sys
	
	print generateLiloConfFile(sys.argv[1])
